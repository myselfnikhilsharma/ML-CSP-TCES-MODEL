<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CSP–TES ML Estimator</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #e8f5e9 0%, #e3f2fd 50%, #f3e5f5 100%);
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: #333;
      overflow-x: hidden;
      position: relative;
    }

    /* HEADER */
    .header-bar {
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 50%, #388e3c 100%);
      color: #fff;
      padding: 28px 20px;
      text-align: center;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 50;
      box-shadow: 0 4px 20px rgba(0,0,0,0.25), 0 2px 10px rgba(76, 175, 80, 0.3);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .header-title {
      font-size: 2.1em;
      font-weight: 600;
      letter-spacing: 1px;
      animation: fadeInDown 0.8s ease-out;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      line-height: 1.3;
    }

    @media (max-width: 768px) {
      .header-title {
        font-size: 1.5em;
        padding: 0 10px;
      }
    }

    @media (max-width: 480px) {
      .header-title {
        font-size: 1.2em;
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .banner {
      margin-top: 8px;
      height: 26px;
      color: #e7ffe7;
      opacity: 0.9;
      overflow: hidden;
    }

    .banner-text {
      position: absolute;
      white-space: nowrap;
      animation: slide-left 16s linear infinite;
      font-size: 1.05em;
    }

    .banner-text:hover {
      animation-play-state: paused;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .banner-text {
        font-size: 0.9em;
      }
    }

    @media (max-width: 480px) {
      .banner-text {
        font-size: 0.75em;
      }
    }

    @keyframes slide-left {
      from { transform: translateX(100%); }
      to   { transform: translateX(-100%); }
    }

    /* MAIN CONTENT */
    .main-container {
      display: flex;
      gap: 25px;
      padding: 40px 30px 50px;
      margin-top: 140px;
      flex: 1;
      animation: fadeIn 1s ease-out;
      position: relative;
      z-index: 1;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
        padding: 30px 20px 40px;
      }
    }

    /* LEFT COLUMN */
    .left-column {
      flex: 1.3;
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .image-box {
      flex: 0 0 auto;
      height: 400px;
      background-image: url("CST.png");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      font-size: 1.5rem;
      font-weight: 600;
      color: #136027;
      letter-spacing: 0.5px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      min-height: 300px;
      text-align: center;
    }

    .image-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.2);
    }

    .info-box {
      flex: 1;
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,255,254,0.95) 100%);
      padding: 28px;
      border-radius: 16px;
      backdrop-filter: blur(12px);
      border: 2px solid rgba(76, 175, 80, 0.2);
      font-size: 16px;
      line-height: 1.8;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
    }

    .info-box:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.2);
      border-color: rgba(76, 175, 80, 0.4);
    }

    .info-box p {
      margin: 0;
    }

    .info-box b {
      color: #1b5e20;
      font-weight: 600;
    }

    /* RIGHT COLUMN */
    .right-column {
      flex: 0.8;
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(250,255,253,0.98) 100%);
      padding: 35px;
      border-radius: 20px;
      border: 2px solid rgba(76, 175, 80, 0.15);
      box-shadow: 0 8px 30px rgba(0,0,0,0.18);
      animation: slideInRight 0.8s ease-out;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @media (max-width: 768px) {
      .right-column {
        padding: 20px;
      }
    }

    h2 {
      text-align: center;
      color: #1b5e20;
      font-size: 40px;
      margin-bottom: 30px;
      font-weight: 600;
      position: relative;
      padding-bottom: 15px;
    }

    h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, #4caf50, #2e7d32);
      border-radius: 2px;
    }

    /* FORM */
    label {
      font-weight: 600;
      margin-top: 12px;
      display: block;
      font-size: 25px;
      color: #1b5e20;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: color 0.3s ease;
    }

    label:hover {
      color: #2e7d32;
    }

    .info-icon {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      background: #4caf50;
      color: white;
      border-radius: 50%;
      text-align: center;
      font-size: 12px;
      font-weight: bold;
      cursor: help;
      transition: all 0.3s ease;
    }

    .info-icon:hover {
      background: #388e3c;
      transform: scale(1.1);
    }

    .info-icon::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: normal;
      white-space: normal;
      width: 280px;
      line-height: 1.5;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .info-icon::before {
      content: '';
      position: absolute;
      bottom: 115%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: #333;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .info-icon:hover::after,
    .info-icon:hover::before {
      opacity: 1;
      visibility: visible;
    }

    input, select {
      width: 100%;
      padding: 16px;
      margin-top: 8px;
      border-radius: 12px;
      border: 2px solid #e0e0e0;
      background: #ffffff;
      font-size: 22px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      font-family: 'Poppins', sans-serif;
    }

    input:hover {
      border-color: #4caf50;
      box-shadow: 0 3px 8px rgba(76,175,80,0.15);
      transform: translateY(-1px);
    }

    input:focus, select:focus {
      border-color: #1a7f38;
      outline: none;
      box-shadow: 0 0 0 3px rgba(76,175,80,0.2);
      background: #fafffe;
      transform: scale(1.01);
    }

    input.valid {
      border-color: #4caf50;
      background: #f1f8f4;
    }

    input.invalid:not(:focus) {
      border-color: #f44336;
      animation: shake 0.5s;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    input::placeholder {
      color: #999;
      font-size: 13px;
      font-style: italic;
    }

    /* BUTTONS */
    .actions {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    button {
      flex: 1;
      padding: 13px;
      font-size: 25px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:hover::before {
      width: 300px;
      height: 300px;
    }

    button:active {
      transform: scale(0.95);
    }

    #submitBtn {
      background: linear-gradient(135deg, #0b6f12, #044408);
      color: white;
      box-shadow: 0 4px 12px rgba(11, 111, 18, 0.3);
    }

    #submitBtn:hover:not(:disabled) {
      background: linear-gradient(135deg, #0d8015, #055009);
      box-shadow: 0 6px 16px rgba(11, 111, 18, 0.4);
      transform: translateY(-2px);
    }

    #submitBtn:disabled {
      background: #9e9e9e;
      cursor: not-allowed;
      box-shadow: none;
      opacity: 0.6;
    }

    #submitBtn.loading {
      pointer-events: none;
    }

    #submitBtn.loading::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      top: 50%;
      left: 50%;
      margin-left: -8px;
      margin-top: -8px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spinner 0.6s linear infinite;
    }

    @keyframes spinner {
      to { transform: rotate(360deg); }
    }

    #clearBtn {
      background: #c62828;
      color: white;
      box-shadow: 0 4px 12px rgba(198, 40, 40, 0.3);
    }

    #clearBtn:hover {
      background: #d32f2f;
      box-shadow: 0 6px 16px rgba(198, 40, 40, 0.4);
      transform: translateY(-2px);
    }

    #prediction {
      margin-top: 22px;
      font-size: 25px;
      font-weight: 600;
      color: #1b5e20;
      min-height: 1.5em;
      padding: 20px 24px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.08), rgba(139, 195, 74, 0.08));
      transition: all 0.3s ease;
      border: 2px solid rgba(76, 175, 80, 0.2);
    }

    #overallEsc {
      margin: 18px 0 10px;
      font-size: 25px;
      font-weight: 600;
      color: #1b5e20;
      min-height: 1.5em;
      padding: 20px 24px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.08), rgba(139, 195, 74, 0.08));
      transition: all 0.3s ease;
      border: 2px solid rgba(76, 175, 80, 0.2);
    }

    .error { 
      color: #b81616;
      background: rgba(244, 67, 54, 0.1) !important;
      border-left: 4px solid #b81616;
      animation: slideInLeft 0.3s ease;
    }

    .loading { 
      color: #aa6c00;
      background: rgba(255, 193, 7, 0.1) !important;
      border-left: 4px solid #aa6c00;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Progress Bar */
    .progress-container {
      width: 100%;
      height: 4px;
      background: #e0e0e0;
      border-radius: 2px;
      overflow: hidden;
      margin: 20px 0;
      display: none;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #4caf50, #8bc34a);
      animation: progress 2s ease-in-out infinite;
    }

    @keyframes progress {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; }
    }

    /* FOOTER */
    .footer {
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
      color: #fff;
      text-align: center;
      padding: 25px 20px;
      margin-top: auto;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
      font-size: 14px;
      line-height: 1.6;
      position: relative;
      z-index: 1;
    }

    .footer a {
      color: #a5d6a7;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .footer a:hover {
      color: #c8e6c9;
      text-decoration: underline;
    }

  </style>
</head>


<body>

  <!-- HEADER -->
  <div class="header-bar">
    <div class="header-title">
      CSP–TES ML Tool: Predict Optimal LCOE & Thermochemical Energy Storage Cost
    </div>
    <div class="banner">
      <div class="banner-text">
        Developed by: Ishan Bajaj Research Group, IIT Kanpur &nbsp;|&nbsp; Contact: ibajaj@iitk.ac.in
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <div class="main-container">

    <!-- LEFT -->
    <div class="left-column">
      <div class="image-box"></div>

      <div class="info-box">
        <p>
          <b>About This Tool</b><br><br>
          This ML‑based estimator delivers rapid, system‑level predictions of the optimal <b>Levelized Cost of Electricity (LCOE)</b> and <b>Energy Storage Cost (ESC)</b> for concentrated solar power plants integrated with thermochemical energy storage (CSP–TES). It is intended for material screening and early‑stage techno‑economic evaluation, removing the need to run computationally intensive optimization for every candidate material. The plant location is in Daggett, California with a capacity of 100 MW.
          <br><br>
          <b>CSP–TES System Overview</b><br>
          • Solar collectors that concentrate sunlight<br>
          • High‑temperature receivers that convert radiation to heat<br>
          • Thermochemical energy‑storage reactors based on reversible redox chemistry<br>
          • High‑efficiency s‑CO₂ Brayton power conversion cycle
          <br><br>
          <b>Storage Chemistry</b><br>
          The underlying TES operates via a reversible redox reaction in an open‑loop configuration (no oxygen storage/compression required):<br>
          MOₓ ⇌ MOᵧ + ν O₂
          <br><br>
          
          <b>Inputs</b><br>
          The estimator accepts nine key material and process properties (thermophysical, stoichiometric, and economic) and maps them to system‑optimal LCOE and ESC, capturing complex nonlinear interactions learned from full system optimizations.
          <br><br>
          
          <b>Assumptions and Calculations</b><br>
          The predictions are based on optimization model which uses thermodynamic equilibrium assumptions (100% conversion, no side products, and stable material) and neglects reaction kinetics.
          <br><br>
          
        </p>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="right-column">
      <h2>Optimal LCOE and ESC Estimator</h2>

      <form id="predictionForm" novalidate>

        <!-- ALL TEXT INPUTS AS REQUESTED -->

        <label>Equilibrium temperature  <span class="info-icon" data-tooltip="Temperature in K at partial pressure of O2 at 0.21 atm (K)">i</span></label>
        <input type="text" id="f1" name="f1" placeholder="Enter value (e.g., 1200)" required />

        <label>Heat of Reaction at 298 K (kJ/kg) <span class="info-icon" data-tooltip="Reaction enthalpy per kg of MOₓ in kJ/kg. Positive = endothermic (charging).">i</span></label>
        <input type="text" id="f2" name="f2" placeholder="Enter value (e.g., 178.5)" required />

        <label>Specific Heat Capacity of MOₓ (kJ/kg-K)</label>
        <input type="text" id="f3" name="f3" placeholder="Enter value (e.g., 1.25)" required />

        <label>Specific Heat Capacity of MOᵧ (kJ/kg-K)</label>
        <input type="text" id="f4" name="f4" placeholder="Enter value (e.g., 1.05)" required />

        <label>Density of MOₓ (g/cm³)</label>
        <input type="text" id="f5" name="f5" placeholder="Enter value (e.g., 3.58)" required />

        <label>Density of MOᵧ (g/cm³)</label>
        <input type="text" id="f6" name="f6" placeholder="Enter value (e.g., 2.71)" required />

        <label>Price ($/MT) <span class="info-icon" data-tooltip="Material purchase price in USD per metric ton ($/MT).">i</span></label>
        <input type="text" id="f7" name="f7" placeholder="Enter value (e.g., 450.00)" required />

        <label>Stoichiometric Coefficient of O₂ <span class="info-icon" data-tooltip="Stoichiometric O₂ coefficient ν in MOₓ ⇌ MOᵧ + ν O₂ (moles O₂ per mole MOₓ).">i</span></label>
        <input type="text" id="f8" name="f8" placeholder="Enter value (e.g., 3.0)" required />

        <label>Molecular Weight of MOₓ (g/mol)</label>
        <input type="text" id="f9" name="f9" placeholder="Enter value (e.g., 100.09)" required />

        <div class="actions">
          <button type="submit" id="submitBtn" disabled>Estimate</button>
          <button type="button" id="clearBtn">Clear</button>
        </div>

        <div class="progress-container" id="progressBar">
          <div class="progress-bar"></div>
        </div>

      </form>

      <div id="prediction" style="margin-bottom:20px;"></div>

      <div id="overallEsc" style="margin-bottom:20px;"></div>
    </div>

  </div>

  <script>
    const form = document.getElementById("predictionForm");
    const submitBtn = document.getElementById("submitBtn");
    const clearBtn = document.getElementById("clearBtn");
    const output = document.getElementById("prediction");
    const overallEsc = document.getElementById("overallEsc");
    const progressBar = document.getElementById("progressBar");

    // Real-time validation for inputs
    const inputs = form.querySelectorAll('input[type="text"]');
    inputs.forEach(input => {
      input.addEventListener('input', (e) => {
        const value = e.target.value.trim();
        if (value === '') {
          e.target.classList.remove('valid', 'invalid');
        } else if (!isNaN(value) && value !== '') {
          e.target.classList.add('valid');
          e.target.classList.remove('invalid');
        } else {
          e.target.classList.add('invalid');
          e.target.classList.remove('valid');
        }
      });

      // Remove invalid class on focus
      input.addEventListener('focus', (e) => {
        e.target.classList.remove('invalid');
      });
    });

    form.addEventListener("input", () => {
      submitBtn.disabled = !form.checkValidity();
    });

    clearBtn.addEventListener("click", () => {
      form.reset();
      output.textContent = "";
      overallEsc.textContent = "";
      submitBtn.disabled = true;
      progressBar.style.display = 'none';

      // Remove validation classes
      inputs.forEach(input => {
        input.classList.remove('valid', 'invalid');
      });
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.classList.add('loading');
      progressBar.style.display = 'block';

      output.textContent = "Estimating...";
      output.className = "loading";
      overallEsc.textContent = "";

      const formData = new FormData(form);
      const params = new URLSearchParams();
      formData.forEach((v, k) => params.append(k, v));
      console.log('Sending form data:', params.toString());

      try {
        const res = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: params
        });

        console.log('Response status:', res.status);
        if (!res.ok) {
          const bodyText = await res.text();
          console.error('Server returned non-OK status', res.status, bodyText);
          throw new Error('Server error: ' + res.status + ' - ' + bodyText);
        }
        const result = await res.json();
        console.log('Response data:', result);
        output.className = "";
        progressBar.style.display = 'none';
        submitBtn.classList.remove('loading');

        if (result.predictions) {
          // Get LCOE value
          const lcoeValue = result.predictions.LCOE || result.predictions["Overall LCOE"] || 
                           Object.values(result.predictions)[0] || 0;
          
          // Display LCOE
          output.innerHTML = `<b>Results:</b><br><br>LCOE: ${lcoeValue} $/kWh`;
          
          // Get ESC value
          overallEsc.innerHTML = "";
          if (result.esc && result.esc.length) {
            const escValue = result.esc[0] || (result.esc.reduce((a, b) => a + b, 0) / result.esc.length);
            overallEsc.innerHTML = `ESC: ${escValue.toFixed(4)} $/kWh-th`;
          }

        } else {
          console.error('Invalid response format:', result);
          output.textContent = "Error: " + (result.error || 'Unexpected response format');
          output.className = "error";
          overallEsc.textContent = "";
        }

      } catch (err) {
        console.error('Fetch or parse error:', err);
        output.textContent = "Prediction failed: " + err.message;
        output.className = "error";
        overallEsc.textContent = "";
        progressBar.style.display = 'none';
        submitBtn.classList.remove('loading');
      }

      submitBtn.disabled = false;
    });

  </script>

  <!-- FOOTER -->
  <div class="footer">
    <p><strong>CSP–TES ML Estimator</strong></p>
    <p>Advanced Machine Learning Tool for Concentrated Solar Power & Thermochemical Energy Storage Analysis</p>
    <p style="margin-top: 10px; font-size: 13px; opacity: 0.9;">© 2025 Ishan Bajaj Research Group | IIT Kanpur | All Rights Reserved</p>
  </div>

</body>
</html>
